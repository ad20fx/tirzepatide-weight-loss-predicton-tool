<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
     <!--
      PAGE: Tirzepatide Weight Loss Prediction Calculator
    PURPOSE: Collect patient inputs and generate a 72-week weight loss trajectory
    -->
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tirzepatide Weight Loss Prediction Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    /* ===== Minimal, accessible styling to make the layout readable ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group .hint {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .dose-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .dose-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .dose-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .dose-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .dose-option .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .dose-option .label {
            font-size: 0.85em;
            opacity: 0.8;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            padding: 30px;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .results-header h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .predictions-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .predictions-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .predictions-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .predictions-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .predictions-table tr:last-child td {
            border-bottom: none;
        }

        .predictions-table tr:hover {
            background: #f8f9fa;
        }

        .metric {
            font-weight: 600;
            color: #667eea;
        }

        .disclaimer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-top: 30px;
            border-radius: 10px;
        }

        .disclaimer h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .disclaimer p {
            color: #856404;
            font-size: 0.9em;
            line-height: 1.6;
        }

        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Tirzepatide Weight Loss Prediction</h1>
            <p>Predict individual 72-week weight loss trajectories based on machine learning</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Adapted from SOPHIA Bariatric Surgery Model</p>
        </div>

        <div class="content">
            <div class="input-section">
                <h2 style="margin-bottom: 25px; color: #333;">Patient Information</h2>
                
                 <!--
      FORM: Collects clinical + demographic inputs required for prediction
    - Current weight (kg)
    - Height (cm)
    - Age (years)
    - Sex (binary options as per source content)
    - Tirzepatide dose (categorical: Low/Medium/High mapped to 5/10/15mg)
    - Diabetes status (none/prediabetes/type 2)
    -->

                <div class="form-group">
                    <label>Current Weight (kg)</label>
                    <input type="number" id="weight" step="0.1" min="50" max="300" placeholder="e.g., 100">
                    <div class="hint">Enter weight in kilograms</div>
                </div>

                <div class="form-group">
                    <label>Height (cm)</label>
                    <input type="number" id="height" step="0.1" min="120" max="250" placeholder="e.g., 175">
                    <div class="hint">Enter height in centimeters</div>
                </div>

                <div class="form-group">
                    <label>Age (years)</label>
                    <input type="number" id="age" min="18" max="80" placeholder="e.g., 45">
                </div>

                <div class="form-group">
                    <label>Sex</label>
                    <select id="sex">
                        <option value="">Select...</option>
                        <option value="Female">Female</option>
                        <option value="Male">Male</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tirzepatide Dose</label>
                    <div class="dose-selector">
                        <div class="dose-option" data-dose="5">
                            <div class="value">5mg</div>
                            <div class="label">Low</div>
                        </div>
                        <div class="dose-option" data-dose="10">
                            <div class="value">10mg</div>
                            <div class="label">Medium</div>
                        </div>
                        <div class="dose-option" data-dose="15">
                            <div class="value">15mg</div>
                            <div class="label">High</div>
                        </div>
                    </div>
                    <input type="hidden" id="dose">
                </div>

                <div class="form-group">
                    <label>Diabetes Status</label>
                    <select id="diabetes">
                        <option value="">Select...</option>
                        <option value="None">No Diabetes</option>
                        <option value="Prediabetes">Prediabetes</option>
                        <option value="Type 2 Diabetes">Type 2 Diabetes</option>
                    </select>
                </div>

                <button class="calculate-btn" onclick="calculatePrediction()">
                    Calculate Weight Loss Trajectory
                </button>
            </div>
            
            <!--
      TABLE: Displays per-timepoint results (e.g., weeks 0‚Äì72)
    COLUMNS: Timepoint, Weight (kg), BMI (kg/m^2), Weight Loss (%)
    -->

            <div class="results-section">
                <div id="initial-message">
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <svg width="120" height="120" style="margin-bottom: 20px;">
                            <circle cx="60" cy="60" r="50" fill="none" stroke="#e0e0e0" stroke-width="4"/>
                            <path d="M 40 60 L 60 40 L 80 60" fill="none" stroke="#e0e0e0" stroke-width="4" stroke-linecap="round"/>
                        </svg>
                        <h3>Enter patient information to see predictions</h3>
                        <p>Fill in the form on the left to generate personalized weight loss trajectory</p>
                    </div>
                </div>


                <div id="loading-message" class="hidden">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Calculating predictions...</p>
                    </div>
                </div>

                <div id="results-display" class="hidden">
                    <div class="results-header">
                        <h2>Predicted Weight Loss Trajectory</h2>
                        <p id="patient-summary" style="color: #666; margin-top: 10px;"></p>
                    </div>

                    <div class="chart-container">
                        <canvas id="trajectoryChart"></canvas>
                    </div>

                    <div class="predictions-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Timepoint</th>
                                    <th>Weight (kg)</th>
                                    <th>BMI (kg/m¬≤)</th>
                                    <th>Weight Loss (%)</th>
                                </tr>
                            </thead>
                            <tbody id="predictions-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="disclaimer">
                        <h3>‚ö†Ô∏è Important Disclaimer</h3>
                        <p>
                            This calculator provides estimates based on clinical trial data and machine learning models. 
                            Individual results may vary. This tool is for informational purposes only and should not 
                            replace professional medical advice. Always consult with your healthcare provider for 
                            personalized medical guidance.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dose selector interaction
        document.querySelectorAll('.dose-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.dose-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                document.getElementById('dose').value = this.dataset.dose;
            });
        });

        let trajectoryChart = null;

        // Prediction algorithm (simplified version based on SURMOUNT-1 results)
        function predictWeightLoss(weight, height, age, sex, dose, diabetes) {
            const heightM = height / 100;
            const bmi = weight / (heightM * heightM);
            
            // Base weight loss by dose (from SURMOUNT-1)
            let baseTWL = {
                5: 15.0,
                10: 19.5,
                15: 20.9
            }[dose] || 15.0;
            
            // Modifiers
            let modifier = 1.0;
            
            // Diabetes effect
            if (diabetes === 'Type 2 Diabetes') {
                modifier *= 0.85;
            } else if (diabetes === 'Prediabetes') {
                modifier *= 0.92;
            }
            
            // Age effect (younger = better)
            const ageEffect = (48 - age) * 0.008;
            modifier *= (1 + ageEffect);
            
            // Sex effect
            if (sex === 'Female') {
                modifier *= 1.02;
            } else {
                modifier *= 0.98;
            }
            
            // BMI effect (higher BMI = slightly better %)
            const bmiEffect = (bmi - 37.5) * 0.005;
            modifier *= (1 + bmiEffect);
            
            // Add variability
            const finalTWL = baseTWL * modifier;
            
            // Generate trajectory (sigmoid curve)
            const timepoints = [0, 4, 8, 12, 24, 52, 72];
            const predictions = [];
            
            timepoints.forEach(week => {
                let timeFactor;
                if (week === 0) {
                    timeFactor = 0;
                } else {
                    // Sigmoid function
                    timeFactor = 1 / (1 + Math.exp(-0.08 * (week - 25)));
                }
                
                const twl = finalTWL * timeFactor;
                const predictedWeight = weight * (1 - twl / 100);
                const predictedBMI = predictedWeight / (heightM * heightM);
                
                predictions.push({
                    week: week,
                    weight: predictedWeight,
                    bmi: predictedBMI,
                    twl: twl
                });
            });
            
            return predictions;
        }

        function calculatePrediction() {
            // Get input values
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseInt(document.getElementById('age').value);
            const sex = document.getElementById('sex').value;
            const dose = parseInt(document.getElementById('dose').value);
            const diabetes = document.getElementById('diabetes').value;
            
            // Validate inputs
            if (!weight || !height || !age || !sex || !dose || !diabetes) {
                alert('Please fill in all fields');
                return;
            }
            
            // Show loading
            document.getElementById('initial-message').classList.add('hidden');
            document.getElementById('results-display').classList.add('hidden');
            document.getElementById('loading-message').classList.remove('hidden');
            
            // Simulate calculation delay
            setTimeout(() => {
                // Calculate predictions
                const predictions = predictWeightLoss(weight, height, age, sex, dose, diabetes);
                
                // Display results
                displayResults(predictions, weight, height, age, sex, dose, diabetes);
                
                // Hide loading, show results
                document.getElementById('loading-message').classList.add('hidden');
                document.getElementById('results-display').classList.remove('hidden');
            }, 1000);
        }

        function displayResults(predictions, weight, height, age, sex, dose, diabetes) {
            const heightM = height / 100;
            const bmi = weight / (heightM * heightM);
            
            // Update patient summary
            document.getElementById('patient-summary').innerHTML = `
                ${age} year old ${sex}, ${weight} kg, ${height} cm (BMI: ${bmi.toFixed(1)} kg/m¬≤), 
                Tirzepatide ${dose}mg, ${diabetes}
            `;
            
            // Update predictions table
            const tbody = document.getElementById('predictions-body');
            tbody.innerHTML = '';
            
            predictions.forEach(pred => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${pred.week === 0 ? 'Baseline' : 'Week ' + pred.week}</strong></td>
                    <td>${pred.weight.toFixed(1)}</td>
                    <td>${pred.bmi.toFixed(1)}</td>
                    <td class="metric">${pred.twl.toFixed(1)}%</td>
                `;
            });
            
            // Update chart
            updateChart(predictions);
        }

        function updateChart(predictions) {
            const ctx = document.getElementById('trajectoryChart').getContext('2d');
            
            if (trajectoryChart) {
                trajectoryChart.destroy();
            }
            
            trajectoryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: predictions.map(p => p.week === 0 ? 'Baseline' : `Week ${p.week}`),
                    datasets: [
                        {
                            label: 'Weight (kg)',
                            data: predictions.map(p => p.weight),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Weight Loss (%)',
                            data: predictions.map(p => p.twl),
                            borderColor: '#f093fb',
                            backgroundColor: 'rgba(240, 147, 251, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y.toFixed(1);
                                    if (context.datasetIndex === 1) {
                                        label += '%';
                                    } else {
                                        label += ' kg';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Weight (kg)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Weight Loss (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                    }
                }
            });
        }
    </script>
</body>
</html>